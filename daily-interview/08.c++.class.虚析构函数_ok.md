问 

在c++中，类中析构函数一般会声明虚函数，这样做什么作用？，目的是为了什么












> 目前测试：
> 看到 这样做什么作用目的是为了？什么但是脑中一片空白，线下测试也是一样
>
> 完全不干思考了







### 1 你的思考（10秒闪过）

~~~c++

class Base1 {
public:
  ~Base1() { cout << "~Base1()\n"; }
};

class Derived1 : public Base1 {
public:
  ~Derived1() { cout << "~Derived1()\n"; }
};

 Base1* bp = new Derived1(); // Upcast 
  delete bp; //~Base1()


class Base2 {
public:
  Base2() 
 { 
   //语法上规定构造函数不能声明为虚函数 error: constructors cannot be declared virtual
   //在构造函数内 可以使用虚函数，只是普通函数的无法发挥虚函数作用
   // 子类对象还没有创建完成，如果通过基类指针调用调用虚函数，没有意义，而是无法发挥的多态的作用
 }
  virtual ~Base2() { cout << "~Base2()\n"; 
  // 析构可以是虚函数,假如不声明为虚函数，有什么危害？
  // 场景--通过通过基类指针访问子类时候，如果声明了虚函数，可以触发析正确析构顺序：首先是当前的的类，然后是起基类。
  // 如果没有有定义虚析构函数的话，属于静态绑定，只根据基类这个类型（this）调用对应函数。
  //说明1 ：场景--A通过基类通过引用访问,或者 通过子类访问 不会出现这样问题。正确触发析构
  //说明2 ，先释放子类，在释放基类 ，这个表示不正确，// A B C  删除 B ，不会触发c的
  // 基类不析构不声明为虚函数 通过自己调用，和引用调用 保持正常的修改，但是通过基类访问无法触发。这可能是是一个bug
    //If a class does not contain virtual functions, that often indicates it is not meant to be used as a base class. 
    // When a class is not intended to be a base class, making the destructor virtual is usually a bad idea
  }
};

class Derived2 : public Base2 {
public:
  ~Derived2() { cout << "~Derived2()\n"; }
};


  Base2* b2p = new Derived2; // Upcast
  delete b2p;
  

  cout<<" ref is ok"<<endl;
  Derived2 dd;
  Base2 &ref =dd;
~~~









###  2你的回答（限制在1分钟，5句话，12秒一句）


结论：



如果一个类的析构函数，不声明为虚函数作为普通的类没有什么(stl这样做的)

但是 如果这个类作为作为实现多态的基类（polymorphic base classes.），

派生类通过new 在在堆上动态创建对象时候，**情况下**释放时候

 Base * bp = new Derived ; 

delete bp

回造成派生类不执行析构。

通过基类指针释放派生类，一定造成回造成派生类不执行析构。



解释：

一个类的析构函数执行顺序是：析构自己，然后修改自己基类（和构造相反）

因为是虚函数，delete bp 执行真正派生类，派生类 自动触发基类 

如果不是虚函数
如果不是触发静态绑定只调用基类析构函数。

|      | 子                 | 基类 |
| ---- | ------------------ | ---- |
|      | 没有发生【不释放】 | 发生 |
|      | 发生               | 发生 |
|      |                    |      |



###  3 鸡蛋里挑骨头（第一句话说关键吗吗，关键词解释了吗）

类析构顺序，

多态实现  ，

对象分配：栈 堆 



4. 相关知识点下一个问题是什么？



# 什么叫做过关（空白就是等于不知道）

10秒内单，如果大脑一片空白，对里面里面基础用法，然后进一步 提问，原理，异常等毫无总结，

代表 你根本无法过关，你必须停下来深入看看看别人怎么做的



































【网上很多提出这样问题，但是答案都是错误的，

可能他们刚学习时候整理的，

根本不能作为最终参考答案，甚至误导，他们10年，20年理解，现在如何解读

这就是你价值，同样的问题，不一样回答，

这就是你价值，同样的问题，不一样回答。

这就是你价值，同样的问题，不一样回答

这就是你价值，同样的问题，不一样回答

】



-----------------------------------------------
涉及关键字 new， 
new
c++ 场景面试时什么？ 
c++ 项目中遇到什么问题？
c ++ 项目异常/失败请下出现什么问题？ 万一呢 
最恶心core， 
细说new与malloc的10点区别

【网上很多提出这样问题，但是答案都是错误的，

可能他们刚学习时候整理的，

根本不能作为最终参考答案，甚至误导，他们10年，20年理解，现在如何解读

这就是你价值，同样的问题，不一样回答，

这就是你价值，同样的问题，不一样回答。

这就是你价值，同样的问题，不一样回答

这就是你价值，同样的问题，不一样回答

】

最关键区别一点是什么？
为没考虑异常，面试官为考虑到了，
根源说你上来就
1感觉太简单了，根本不可能问答到，bat还是其他公司，不可能问老掉牙问题 把这问题pass了
2 你根本整理 活着网上寻找全面答案
3 项目中动手测试，其实遇到过的，抛异常 

涉及关键字 堆栈
c++ 场景面试时什么？ 
c++ 项目中遇到什么问题？
c ++ 项目异常/失败请下出现什么问题？ 万一呢 
最关键区别一点是什么？

https://www.cnblogs.com/LonelyEnvoy/p/5865832.html
http://www.cplusplus.com/reference/new/operator%20new/
-----------------------------------------------
涉及关键字 多态， 
c++ 场景面试时什么？ 
c++ 项目中遇到什么问题？
c ++ 项目异常/失败请下出现什么问题？ 万一呢 
最关键区别一点是什么？

-----------------------------------------------

涉及关键字 异常  core， 
c++ 场景面试时什么？ 
c++ 项目中遇到什么问题？
c ++ 项目异常/失败请下出现什么问题？ 万一呢 
最关键区别一点是什么？
一个C++bug引入的许多知识